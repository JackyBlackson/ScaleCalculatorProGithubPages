(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7861:function(e,i,t){Promise.resolve().then(t.bind(t,1247))},1247:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return F}});var n=t(7437);t(594),t(7341);var r=t(1484),c=t(8569),l=t(8625),s=t(8924),a=t(3288),u=t(1119),o=t(9332),d=t(115),f=t(2265),h=t(6614);function p(e){let{uuid:i,name:t}=e,{scProject:r,setSCProject:l}=(0,f.useContext)(h.g),u=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.ZP,{type:"primary",shape:"circle",className:"m-1",onClick:e=>{r.normalizeUnifiedScalesTo(i),l(r)},children:(0,n.jsx)(d.Z,{bicode:"1-square"})}),(0,n.jsx)(s.ZP,{default:!0,shape:"circle",className:"m-1",onClick:e=>{let n=prompt("重命名：请输入单位名称",t);if(n){if(r.containsUnit(n)){c.ZP.warning("名为".concat(n,"的单位已经存在，请换一个名字"));return}r.unitMap.set(i,n)?l(r):c.ZP.error("以".concat(n,"为名称创建单位失败，发生了未知错误"))}},children:(0,n.jsx)(d.Z,{bicode:"pencil-square"})}),(0,n.jsx)(s.ZP,{danger:!0,type:"dashed",shape:"circle",className:"m-1",onClick:e=>{if(!confirm("删除单位：您是否要删除单位 “"+t+"”？这会【一并删除】包含此单位的比例尺以及记录！请确认：")){c.ZP.info("您已取消删除单位");return}r.unitMap.delete(i),r.unifiedScaleMap.delete(i),i===r.unifiedTarget&&(r.unifiedTarget=null),r.scaleDefinitionList=r.scaleDefinitionList.filter(e=>{for(let t=0;t<e.scales.length;t++)if(e.scales[t].unitUuid===i)return console.log("delete scale: ",e),!1;return!0}),r.recordList=r.recordList.filter(e=>(console.log("record.unitUuid",e.unitUuid),console.log("uuid",i),console.log("keep record? ",e.unitUuid!==i),e.unitUuid!==i)),r.calculateUnifiedScalers(),l(r)},children:(0,n.jsx)(d.Z,{bicode:"trash"})})]});return(0,n.jsx)(a.Z,{children:(0,n.jsx)(o.Z,{content:u,children:(0,n.jsx)("div",{className:"m-1 ScaleCalculatorFormArea",onClick:e=>{},children:(0,n.jsx)("strong",{children:t})})})})}var x=t(2250);function m(e){let{uuid:i,name:t,onChange:r,defaultValue:c,value:s}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.Z,{title:"输入数字，下方显示计算结果",children:(0,n.jsx)(x.Z,{value:s,defaultValue:c,changeOnWheel:!0,onChange:e=>{r(i,t,e)},block:!0})})})}var j=t(7590);function g(e){let{uuid:i}=e,{scProject:t,setSCProject:r}=(0,f.useContext)(h.g);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.Z,{title:"删除该比例尺",children:(0,n.jsx)(s.ZP,{type:"dashed",shape:"circle",onClick:e=>{t.scaleDefinitionList=t.scaleDefinitionList.filter(e=>e.uuid!==i),t.calculateUnifiedScalers()||(t.unifiedScaleMap=new Map,c.ZP.error("当前比例尺无法计算，请检查是否重叠或不连通")),r(t),c.ZP.success("成功删除比例尺")},children:(0,n.jsx)(d.Z,{bicode:"trash-fill"})})})})}function Z(e){let{name:i,scaleUuid:t,unitUuid:r}=e,{scProject:u,setSCProject:p}=(0,f.useContext)(h.g),x=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Z,{title:"修改数据",children:(0,n.jsx)(s.ZP,{default:!0,shape:"circle",className:"m-1",onClick:e=>{let n=Number.parseFloat(prompt("重命名：请输入单位名称",i));n&&u.scaleDefinitionList.forEach(e=>{e.uuid===t&&(e.scales.forEach(e=>{if(e.unitUuid===r){e.value=n,c.ZP.success("成功修改比例尺定义数值");return}}),e.scales.push({unitUuid:r,value:n}),u.calculateUnifiedScalers()||c.ZP.error("当前比例尺无法计算，请检查是否重叠或不连通"),p(u),c.ZP.success("成功为比例尺新增数据"))})},children:(0,n.jsx)(d.Z,{bicode:"pencil-square"})})}),(0,n.jsx)(l.Z,{title:"清空此项",children:(0,n.jsx)(s.ZP,{danger:!0,type:"dashed",shape:"circle",className:"m-1",onClick:e=>{let i=!1;u.scaleDefinitionList.forEach(e=>{e.uuid===t&&(e.scales=e.scales.filter(e=>e.unitUuid!==r),u.calculateUnifiedScalers()||c.ZP.error("当前比例尺无法计算，请检查是否重叠或不连通"),p(u),i=!0,c.ZP.success("成功删除比例尺中的项"))}),i||c.ZP.error("无法删除比例尺中的这条记录")},children:(0,n.jsx)(d.Z,{bicode:"trash"})})})]});return(0,n.jsx)(a.Z,{children:(0,n.jsx)(o.Z,{content:x,children:(0,n.jsx)("div",{className:"m-1 SCFormScaleItem",style:{background:"---"!==i?"#73fc8a":"#e1fde6"},children:(0,n.jsx)("a",{children:i})})})})}function U(e){let{name:i,unitUuid:t,isOrigin:r}=e,{scProject:u,setSCProject:p}=(0,f.useContext)(h.g),x=(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.Z,{title:"将当前数值添加为记录",children:(0,n.jsx)(s.ZP,{default:!0,shape:"circle",className:"m-1",onClick:e=>{let n=Number.parseFloat(i);if(!n){c.ZP.error("无法创建记录：“".concat(i,"”不可被用于创建记录"));return}let r=prompt("创建记录：请填写记录名称");n&&r?(u.createRecord(t,Number.parseFloat(i),r),p(u),c.ZP.success("成功创建名为“".concat(r,"”的记录"))):c.ZP.error("无法创建记录：记录名称为空")},children:(0,n.jsx)(d.Z,{bicode:"bookmark-plus-fill"})})})});return(0,n.jsx)(a.Z,{children:(0,n.jsx)(o.Z,{content:x,children:(0,n.jsx)("div",{className:"m-1 SCFormScaleItem",style:{background:r?"#ffc254":"---"===i?"#f8e9cd":"#ffd886"},children:(0,n.jsx)("a",{children:i})})})})}function S(e){let{name:i,unitUuid:t,isOrigin:r}=e,{scProject:c,setSCProject:l}=(0,f.useContext)(h.g);return(0,n.jsx)(a.Z,{children:(0,n.jsx)("div",{className:"m-1 SCFormScaleItem align-self-center",style:{background:r?"#338aff":"---"===i?"#dcebff":"#8cbcff"},children:(0,n.jsx)("a",{children:i})})})}function P(e){let{name:i,unitUuid:t,isOrigin:r}=e,{scProject:u,setSCProject:p}=(0,f.useContext)(h.g),x=(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.Z,{title:"将当前数值添加为记录",children:(0,n.jsx)(s.ZP,{default:!0,shape:"circle",className:"m-1",onClick:e=>{let n=Number.parseFloat(i);if(!n){c.ZP.error("无法创建记录：“".concat(i,"”不可被用于创建记录"));return}let r=prompt("创建记录：请填写记录名称");n&&r?(u.createRecord(t,Number.parseFloat(i),r),p(u),c.ZP.success("成功创建名为“".concat(r,"”的记录"))):c.ZP.error("无法创建记录：记录名称为空")},children:(0,n.jsx)(d.Z,{bicode:"bookmark-plus-fill"})})})});return(0,n.jsx)(a.Z,{children:(0,n.jsx)(o.Z,{content:x,children:(0,n.jsx)("div",{className:"m-1 SCFormScaleItem",style:{background:r?"#ff5454":"---"===i?"#ffe2e2":"#ff9696"},children:(0,n.jsx)("a",{children:i})})})})}function C(e){let{uuid:i}=e,{scProject:t,setSCProject:r}=(0,f.useContext)(h.g);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.Z,{title:"删除该记录",children:(0,n.jsx)(s.ZP,{type:"dashed",shape:"circle",onClick:e=>{t.recordList=t.recordList.filter(e=>e.uuid!==i),r(t),c.ZP.success("成功删除记录")},children:(0,n.jsx)(d.Z,{bicode:"trash-fill"})})})})}t(7424);let{Title:M,Paragraph:b,Text:E,Link:k}=r.default;function v(){let{scProject:e,setSCProject:i}=(0,f.useContext)(h.g),[t,r]=(0,f.useState)(new Map),[o,x]=(0,f.useState)([]),M=(i,n,c)=>{t.set(i,Number.parseFloat(c)),x(e.calculate(i,c)),r(new Map(t))},b=[{title:"项目",dataIndex:"item",key:"item",render:e=>(0,n.jsx)("strong",{children:e}),fixed:!0,align:"center",width:100}],E=[],k={key:"unitInfoRow",item:"单位名称",controls:(0,n.jsx)(l.Z,{title:"新建单位",children:(0,n.jsx)(s.ZP,{onClick:t=>{let n=prompt("添加单位：请输入单位名称");if(n){if(e.containsUnit(n)){c.ZP.warning("名为".concat(n,"的单位已经存在，请换一个名字"));return}e.addUnit(n)?i(e):c.ZP.error("以".concat(n,"为名称创建单位失败，发生了未知错误"))}},shape:"circle",children:(0,n.jsx)(d.Z,{bicode:"plus-circle-fill"})})})},v={key:"unifiedScaleRow",item:"统一比例尺",controls:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.Z,{title:"重新计算统一比例尺",children:(0,n.jsx)(s.ZP,{shape:"circle",onClick:()=>{e.calculateUnifiedScalers()?(i(e),c.ZP.success("成功重新计算统一比例尺")):c.ZP.error("当前比例尺无法计算，请检查是否重叠或不连通")},children:(0,n.jsx)(d.Z,{bicode:"calculator-fill"})})})})},F={key:"scaleInputRow",item:"输入栏",controls:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.Z,{title:"将左侧值创建为新比例尺",children:(0,n.jsx)(s.ZP,{shape:"circle",onClick:()=>{let n={uuid:(0,j.D)(),scales:[]};if(t.forEach((e,i,t)=>{e&&n.scales.push({unitUuid:i,value:e})}),n.scales.length<=1){c.ZP.warning("您当前输入的比例尺只有".concat(n.scales.length,"个单位，应包含至少2个单位"));return}e.scaleDefinitionList.push(n),e.calculateUnifiedScalers()||c.ZP.error("当前比例尺无法计算，请检查是否重叠或不连通"),i(e),r(new Map),c.ZP.success("成功添加比例尺")},children:(0,n.jsx)(d.Z,{bicode:"arrow-up-square-fill"})})})})},L={key:"resultRow",item:"计算结果",controls:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.Z,{title:"清空输入及计算结果",children:(0,n.jsx)(s.ZP,{shape:"circle",onClick:e=>{r(new Map),x([])},children:(0,n.jsx)(d.Z,{bicode:"x-circle"})})})})};return e.unitMap.forEach((i,r,c)=>{b.push({title:i,dataIndex:r,key:r,align:"center",width:100}),k[r]=(0,n.jsx)(p,{uuid:r,name:i});let l=e.unifiedScaleMap.get(r);v[r]=(0,n.jsx)("a",{children:l?parseFloat(l.toFixed(4)):"---"}),v[r]=(0,n.jsx)(P,{unitUuid:r,name:l?parseFloat(l.toFixed(4)):"---",isOrigin:!1}),L[r]=(0,n.jsx)(U,{unitUuid:r,name:"---",isOrigin:!1}),F[r]=(0,n.jsx)(m,{uuid:r,name:i,onChange:M,defaultValue:t.get(r),value:t.get(r)})}),b.push({title:"操作",dataIndex:"controls",key:"controls",fixed:!0,align:"left",width:100}),E.push(k,v),e.scaleDefinitionList.forEach((i,t,r)=>{let c={key:"scaleRow".concat(t),item:"比例尺".concat(t+1),controls:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(g,{uuid:i.uuid})})};e.unitMap.forEach((e,t,r)=>{c[t]=(0,n.jsx)(Z,{name:"---",scaleUuid:i.uuid,unitUuid:t})}),i.scales.forEach((e,t,r)=>{c[e.unitUuid]=(0,n.jsx)(Z,{name:e.value,scaleUuid:i.uuid,unitUuid:e.unitUuid})}),E.push(c)}),o.forEach((e,i,t)=>{let r=e.value;L[e.unitUuid]=(0,n.jsx)(U,{unitUuid:e.unitUuid,name:r?parseFloat(r.toFixed(4)):"---",isOrigin:e.isOrigin})}),E.push(F,L),e.recordList.forEach((i,t,r)=>{let c={key:"recordRow".concat(t),item:"“".concat(i.name,"”"),controls:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(C,{uuid:i.uuid})})};e.unitMap.forEach((e,i,t)=>{c[i]=(0,n.jsx)(S,{name:"---",isOrigin:!1,unitUuid:i})}),c[i.unitUuid]=(0,n.jsx)(S,{unitUuid:i.unitUuid,name:i.value?parseFloat(i.value.toFixed(4)):"---",isOrigin:!0}),e.calculate(i.unitUuid,i.value).forEach((e,i,t)=>{let r=e.value;c[e.unitUuid]=(0,n.jsx)(S,{unitUuid:e.unitUuid,name:r?parseFloat(r.toFixed(4)):"---",isOrigin:e.isOrigin})}),E.push(c)}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.Z,{direction:"vertical",align:"center",children:(0,n.jsxs)("h4",{style:{textAlign:"center",marginBottom:"10px",color:"#666666"},children:["工程名称：",(0,n.jsx)("strong",{style:{color:"#333333"},children:e.name}),(0,n.jsx)(l.Z,{title:"修改工程名称",children:(0,n.jsx)(s.ZP,{shape:"circle",icon:(0,n.jsx)(d.Z,{bicode:"pencil-square"}),style:{marginLeft:"15px"},onClick:t=>{let n=prompt("修改工程名称：请输入新的工程名称",e.name);if(!n){c.ZP.error("您输入的名称为空，或已经取消，操作失败");return}e.name=n,i(e),c.ZP.success("成功修改工程标题为 “".concat(n,"”"))}})})]})}),(0,n.jsx)(u.Z,{columns:b,dataSource:E,pagination:!1,bordered:!0,showHeader:!1,sticky:!0,size:"small",scroll:{scrollToFirstRowOnChange:!1,x:!0}})]})}function F(){return(0,n.jsx)(v,{})}},6614:function(e,i,t){"use strict";t.d(i,{H:function(){return s},g:function(){return l}});var n=t(7437),r=t(2265),c=t(2290);let l=(0,r.createContext)(new c.N),s=e=>{let{children:i}=e,[t,s]=(0,r.useState)(new c.N);return(0,r.useEffect)(()=>{let e=localStorage.getItem("scaleCalculatorProject");if(console.log("storedProjectJson",e),e){let i=JSON.parse(e);console.log("storedProjectObject",i);let t=c.N.deserializeFromObject(i);console.log("updateProjectClass",t),s(t)}},[]),(0,n.jsx)(l.Provider,{value:{scProject:t,setSCProject:e=>{let i=c.N.from(e);s(i),localStorage.setItem("scaleCalculatorProject",JSON.stringify(i.getSerializableObject()))}},children:i})}},115:function(e,i,t){"use strict";t.d(i,{Z:function(){return r}});var n=t(7437);function r(e){let{bicode:i="x-diamond"}=e;return(0,n.jsx)("i",{className:"bi bi-"+i})}},7341:function(e,i,t){"use strict";t.d(i,{Z4:function(){return n},qH:function(){return r}});let n="ScaleCalculatorPro",r="1.0.0 BETA"},2290:function(e,i,t){"use strict";t.d(i,{N:function(){return s}});var n=t(7590);function r(e){let i={};return e.forEach((e,t)=>{i[t]=e}),i}function c(e){let i=new Map;return Object.keys(e).forEach(t=>{i.set(t,e[t])}),i}var l=t(8569);class s{static from(e){let i=new s;return i.unitMap=new Map(Array.from(e.unitMap)),i.scaleDefinitionList=Array.from(e.scaleDefinitionList),i.recordList=e.recordList.map(e=>e),i.unifiedScaleMap=new Map(Array.from(e.unifiedScaleMap)),i.unifiedTarget=e.unifiedTarget,i.color=e.color||"4b0082",i.calculateResult=e.calculateResult?Array.from(e.calculateResult):[],e.uuid?i.uuid=e.uuid:i.uuid=(0,n.D)(),i.name=e.name?e.name:"ScaleCalculatorPro工程",i}static deserializeFromObject(e){return e.unitMap=c(e.unitMap),e.unifiedScaleMap=c(e.unifiedScaleMap),s.from(e)}getSerializableObject(){let e=s.from(this);return e.unitMap=r(this.unitMap),e.unifiedScaleMap=r(this.unifiedScaleMap),e}canCalculateUnifiedScales(){if(!this.scaleDefinitionList||0===this.scaleDefinitionList.length)return!1;let e=[];return console.log("this.scaleDefinitionList",this.scaleDefinitionList),this.scaleDefinitionList.forEach((i,t,n)=>{console.log("scaleDefinition",i);let r=[];if(e.forEach((e,t,n)=>{console.log("tree",e);let c=0;if(i.scales.forEach((i,t,n)=>{e.has(i.unitUuid)&&c++}),c>1)return console.log("CAN'T CALCULATE: SCALE DUPLICATED"),l.ZP.error("计算失败：比例尺重叠，请编辑比例尺后重试"),!1;1===c&&(i.scales.forEach((i,t,n)=>{e.add(i.unitUuid)}),r.push(e))}),r.length>1){let i=new Set;r.forEach(t=>{t.forEach(e=>{i.add(e)}),e=e.filter(e=>e!==t)})}else if(r.length<1){console.log("no match tree, add one");let t=new Set;i.scales.forEach((e,i,n)=>{t.add(e.unitUuid)}),e.push(t),console.log("new Tree: ",t)}}),!(e.length>1)||(console.log("CAN'T CALCULATE: MORE THAN ONE SCALE TREE"),l.ZP.error("计算失败：比例尺不连通，具有多个独立的部分"),!1)}calculate(e,i){if(!this.unifiedScaleMap.has(e))return[];{let t=[],n=this.unifiedScaleMap.get(e);return this.unifiedScaleMap.forEach((r,c)=>{t.push({unitUuid:c,value:r*i/n,isOrigin:e===c})}),t}}createRecord(e,i,t){this.recordList.push({uuid:(0,n.D)(),unitUuid:e,value:i,name:t})}calculateUnifiedScalers(){if(this.unifiedScaleMap=new Map,!this.canCalculateUnifiedScales())return!1;let e=new Set,i=new Set;for(this.scaleDefinitionList[0].scales.forEach((i,t,n)=>{this.unifiedScaleMap.set(i.unitUuid,i.value),e.add(i.unitUuid)}),i.add(0);i.size<this.scaleDefinitionList.length;)this.scaleDefinitionList.forEach((t,n,r)=>{if(console.log("index",n),!i.has(n)){console.log("is not visited",n);let r=null,c=-1;if(t.scales.forEach((i,t,n)=>{e.has(i.unitUuid)&&(r=i.unitUuid,c=i.value)}),r){console.log("have pivot point",n);let l=this.unifiedScaleMap.get(r);t.scales.forEach((i,t,n)=>{this.unifiedScaleMap.set(i.unitUuid,l/c*i.value),e.add(i.unitUuid)}),i.add(n)}}});this.unifiedTarget||(this.unifiedTarget=this.scaleDefinitionList[0].scales[0].unitUuid);let t=this.unifiedScaleMap.get(this.unifiedTarget);return this.unifiedScaleMap.forEach((e,i,n)=>{this.unifiedScaleMap.set(i,e/t)}),!0}normalizeUnifiedScalesTo(e){return this.unifiedTarget=e,this.calculateUnifiedScalers(),!0}containsUnit(e){for(let i of this.unitMap.values())if(e===i)return!0;return!1}addUnit(e){if(this.containsUnit(e))return null;let i=(0,n.D)();return this.unitMap.set(i,e),i}getUnitUuid(e){let i="";return this.unitMap.forEach((t,n,r)=>{t===e&&(i=n)}),i}constructor(){this.unitMap=new Map,this.scaleDefinitionList=[],this.recordList=[],this.unifiedScaleMap=new Map,this.unifiedTarget=null,this.color="4b0082",this.uuid=(0,n.D)(),this.calculateResult=[],this.name="默认创建的第一个工程"}}},7590:function(e,i,t){"use strict";t.d(i,{D:function(){return r}});var n=t(920);function r(){return(0,n.Z)()}}},function(e){e.O(0,[610,21,381,971,23,744],function(){return e(e.s=7861)}),_N_E=e.O()}]);