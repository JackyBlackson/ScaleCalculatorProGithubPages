(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{4315:function(e,t,i){Promise.resolve().then(i.bind(i,8504))},8504:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return C}});var s=i(7437),r=i(5326),n=i.n(r);i(4284),i(3054);var c=i(7341),a=i(7138),l=i(115),o=i(8569),u=i(6704),d=i(3288),h=i(6001),f=i(4722),p=i(8924),j=i(2265),m=i(2290);class g{static from(e){return new g(e.projectList.map(e=>m.N.from(e)))}getSerializableObject(){return new g(this.projectList.map(e=>e.getSerializableObject()))}static deserializeFromObject(e){return new g(e.projectList.map(e=>m.N.deserializeFromObject(e)))}add(e){this.projectList.push(e)}update(e){for(let t=0;t<this.projectList.length;t++)if(this.projectList[t].uuid===e.uuid)return this.projectList[t]=e,!0;return!1}get(e){for(let t=0;t<this.projectList.length;t++)if(this.projectList[t].uuid===e)return this.projectList[t];return null}constructor(e){this.projectList=e||[]}}var x=i(6614);let b=(0,j.createContext)(new g),v=e=>{let{children:t}=e,[i,r]=(0,j.useState)(new g);return(0,j.useEffect)(()=>{let e=localStorage.getItem("scaleCalculatorProjectRegistry");if(console.log("storedProjectRegistryJson",e),e){let t=JSON.parse(e);console.log("storedProjectRegistryObject",t);let i=g.deserializeFromObject(t);console.log("updateProjectRegistryClass",i),r(i)}},[]),(0,s.jsx)(b.Provider,{value:{scProjectRegistry:i,setSCProjectRegistry:e=>{let t=g.from(e);r(g.from(t)),localStorage.setItem("scaleCalculatorProjectRegistry",JSON.stringify(t.getSerializableObject()))}},children:t})};function S(e){let{title:t=c.Z4,items:i={}}=e,[r,n]=(0,j.useState)(!1),{scProjectRegistry:g,setSCProjectRegistry:v}=(0,j.useContext)(b),{scProject:S,setSCProject:L}=(0,j.useContext)(x.g),N=e=>{n(!1);let t=prompt("新建工程：请输入工程名称","新工程");if(!t){o.ZP.error("您输入的工程名称为空，新建工程动作取消");return}g.projectList.push(S);let i=new m.N;i.name=t,L(i),v(g),o.ZP.success("成功新建工程")},Z=e=>{n(!1),g.projectList.push(S),g.projectList=g.projectList.filter(t=>t.uuid!==e.uuid),L(e),v(g),o.ZP.success("成功加载工程，并保存原加载工程")},y=e=>{if(g.projectList=g.projectList.filter(t=>(console.log("item === project? ",t.uuid===e.uuid),t.uuid!==e.uuid)),o.ZP.success("成功删除工程"),S.uuid===e.uuid){if(g.projectList.length<=0){let e=prompt("删除工程：当前无可用工程，请输入名称创建新的工程","新工程");e||(e="新工程");let t=new m.N;t.name=e,L(t),o.ZP.success("成功新建工程")}else L(g.projectList[0]),g.projectList=g.projectList.filter((e,t)=>t>0),o.ZP.info("当前加载项目被删除，自动切换到未加载项目中的第一个")}v(g)},C=e=>{prompt("导出工程：复制下面文本框中的文字，发送给其他用户，即可在其他用户处导入该工程",JSON.stringify(e.getSerializableObject()))};return(0,s.jsxs)("nav",{id:"navigator",className:"navbar navbar-expand-lg fixed-top bg-white box-shadow",style:{zIndex:99},children:[(0,s.jsxs)("div",{className:"container-fluid",children:[(0,s.jsxs)("div",{className:"navbar-brand",children:[(0,s.jsx)("i",{className:"bi bi-rulers"}),c.Z4]}),(0,s.jsx)("button",{className:"navbar-toggler bg-purple-700 rounded-3xl",type:"button","data-bs-toggle":"collapse","data-bs-target":"#mynavbar",children:(0,s.jsx)("i",{className:"bi bi-list"})}),(0,s.jsx)("div",{className:"collapse navbar-collapse",id:"mynavbar",children:(0,s.jsxs)("ul",{className:"navbar-nav me-auto",children:[(0,s.jsx)("li",{className:"nav-item m-2",onClick:e=>{n(!0)},children:(0,s.jsxs)(a.default,{href:"",children:[(0,s.jsx)(l.Z,{bicode:"card-list"}),"工程列表"]})},"工程列表"),(0,s.jsx)("li",{className:"nav-item m-2",onClick:N,children:(0,s.jsxs)(a.default,{href:"",children:[(0,s.jsx)(l.Z,{bicode:"file-earmark-plus"}),"新建工程"]})},"新建工程"),(0,s.jsx)("li",{className:"nav-item m-2",onClick:()=>C(S),children:(0,s.jsxs)(a.default,{href:"",children:[(0,s.jsx)(l.Z,{bicode:"share"}),"导出工程"]})},"导出工程"),(0,s.jsx)("li",{className:"nav-item m-2",onClick:()=>{let e=prompt("导入工程：请将工程导出的文本复制到下面的输入框");try{JSON.parse(e);let t=m.N.deserializeFromObject(e);if(t.uuid===S.uuid){o.ZP.error("已经有相同的工程存在！导入失败");return}for(let e=0;e<g.projectList.length;e++)if(g.projectList[e].uuid===S.uuid){o.ZP.error("已经有相同的工程存在！导入失败");return}g.projectList.push(t),v(g),o.ZP.success("导入工程 “".concat(t.name,"” 成功！请查看工程列表"))}catch(e){o.ZP.error("您输入的工程文本有误，无法导入工程")}},children:(0,s.jsxs)(a.default,{href:"",children:[(0,s.jsx)(l.Z,{bicode:"box-arrow-in-down"}),"导入工程"]})},"导入工程"),(0,s.jsx)("li",{className:"nav-item m-2",onClick:e=>{alert("ScaleCalculatorPro 比例尺计算器"),alert("作者：Jacky_Blackson"),alert("当前版本：".concat(c.qH))},children:(0,s.jsxs)(a.default,{href:"",children:[(0,s.jsx)(l.Z,{bicode:"info-circle"}),"关于作者"]})},"关于作者")]})})]}),(0,s.jsxs)(u.Z,{title:"工程列表",onClose:e=>{n(!1)},open:r,styles:{zIndex:1919810},children:[(0,s.jsxs)(d.Z,{direction:"vertical",style:{width:"100%"},children:[(0,s.jsx)(h.Z.Ribbon,{text:"当前工程",color:"green",children:(0,s.jsx)(f.Z,{message:S.name,description:(0,s.jsxs)(s.Fragment,{children:["uuid = ",(0,s.jsx)("code",{children:S.uuid})]}),type:"success",action:(0,s.jsxs)(d.Z,{direction:"vertical",children:[(0,s.jsx)(p.ZP,{size:"small",type:"primary",disabled:!0,children:"加载"}),(0,s.jsx)(p.ZP,{size:"small",onClick:()=>C(S),children:"分享"}),(0,s.jsx)(p.ZP,{size:"small",danger:!0,ghost:!0,onClick:()=>y(S),children:"删除"})]}),showIcon:!0})}),g&&g.projectList?g.projectList.map(e=>(0,s.jsx)(f.Z,{message:e.name,description:(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("p",{children:["uuid = ",(0,s.jsx)("code",{children:e.uuid})]})}),type:"info",action:(0,s.jsxs)(d.Z,{direction:"vertical",children:[(0,s.jsx)(p.ZP,{size:"small",type:"primary",onClick:()=>Z(e),children:"加载"}),(0,s.jsx)(p.ZP,{size:"small",onClick:()=>C(e),children:"分享"}),(0,s.jsx)(p.ZP,{size:"small",danger:!0,ghost:!0,onClick:()=>y(e),children:"删除"})]}),showIcon:!0},"projectList-".concat(e.name))):(0,s.jsx)(s.Fragment,{})]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("br",{}),"到底辣！没有更多的内容了……"]}),(0,s.jsx)(p.ZP,{block:!0,type:"primary",onClick:N,children:"没有工程？点我创建工程"})]})]})}var L=i(5011),N=()=>{let{scProject:e,setSCProject:t}=(0,j.useContext)(x.g);return(0,s.jsx)(L.Z,{icon:(0,s.jsx)(l.Z,{bicode:"radioactive"}),description:"清空本地存储",shape:"square",onClick:()=>{let t="".concat(c.Z4,"-").concat(e.name);if(prompt("小心！你正在试图清空本地的所有项目！请在下面输入“".concat(t,"” 来确认删除："))!==t){o.ZP.info("万幸~ 您取消了清空本地存储！本地存储的项目逃过一劫~");return}localStorage.clear(),o.ZP.success("成功清空本地存储"),alert("成功清空本地存储，点击确定以重新刷新页面"),window.location.reload()},tooltip:"小心！清空所有项目！你会丢失全部的项目！"})},Z=i(6407);let y=e=>{let{children:t}=e;return(0,s.jsx)(v,{children:(0,s.jsx)(x.H,{children:t})})};function C(e){let{children:t,side:i}=e;return(0,s.jsxs)("html",{lang:"en",children:[(0,s.jsxs)("head",{children:[(0,s.jsx)("link",{href:"https://cdn.staticfile.org/twitter-bootstrap/5.1.3/css/bootstrap.min.css",rel:"stylesheet"}),(0,s.jsx)("link",{href:"https://cdn.staticfile.net/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css",rel:"stylesheet"}),(0,s.jsx)("script",{src:"https://cdn.staticfile.org/twitter-bootstrap/5.1.3/js/bootstrap.min.js",async:!0}),(0,s.jsx)("script",{src:"https://cdn.staticfile.org/popper.js/2.9.3/umd/popper.min.js",async:!0}),(0,s.jsx)("title",{})]}),(0,s.jsx)("body",{className:n().className,children:(0,s.jsx)(y,{children:(0,s.jsxs)(Z.D,{content:c.Z4,children:[(0,s.jsx)("header",{children:(0,s.jsx)(S,{})}),(0,s.jsx)("main",{style:{marginTop:"100px"},children:(0,s.jsxs)("div",{id:"basic-container",className:"container-fluid",children:[(0,s.jsx)("div",{id:"body-container",className:"row m-3 il-round-border p-2 pt-3",style:{height:"100%"},children:t}),(0,s.jsxs)(L.Z.Group,{shape:"circle",children:[(0,s.jsx)(N,{}),(0,s.jsx)(L.Z.BackTop,{tooltip:"返回页面顶部"})]})]})}),(0,s.jsx)("footer",{children:(0,s.jsx)("div",{id:"footer-container",className:"container-fluid",children:(0,s.jsx)("div",{id:"footer",className:"container-fluid",children:(0,s.jsx)("div",{id:"copyright",className:"d-flex justify-content-center",children:(0,s.jsx)("div",{className:"align-content-center align-self-center align",children:(0,s.jsxs)("p",{children:["Copyright \xa9 2022-2024 ",c.Z4,". Made with ❤ by Jacky_Blackson. All rights reserved."]})})})})})})]})})})]})}},6614:function(e,t,i){"use strict";i.d(t,{H:function(){return a},g:function(){return c}});var s=i(7437),r=i(2265),n=i(2290);let c=(0,r.createContext)(new n.N),a=e=>{let{children:t}=e,[i,a]=(0,r.useState)(new n.N);return(0,r.useEffect)(()=>{let e=localStorage.getItem("scaleCalculatorProject");if(console.log("storedProjectJson",e),e){let t=JSON.parse(e);console.log("storedProjectObject",t);let i=n.N.deserializeFromObject(t);console.log("updateProjectClass",i),a(i)}},[]),(0,s.jsx)(c.Provider,{value:{scProject:i,setSCProject:e=>{let t=n.N.from(e);a(t),localStorage.setItem("scaleCalculatorProject",JSON.stringify(t.getSerializableObject()))}},children:t})}},115:function(e,t,i){"use strict";i.d(t,{Z:function(){return r}});var s=i(7437);function r(e){let{bicode:t="x-diamond"}=e;return(0,s.jsx)("i",{className:"bi bi-"+t})}},7341:function(e,t,i){"use strict";i.d(t,{Z4:function(){return s},qH:function(){return r}});let s="ScaleCalculatorPro",r="1.0.0 BETA"},2290:function(e,t,i){"use strict";i.d(t,{N:function(){return a}});var s=i(7590);function r(e){let t={};return e.forEach((e,i)=>{t[i]=e}),t}function n(e){let t=new Map;return Object.keys(e).forEach(i=>{t.set(i,e[i])}),t}var c=i(8569);class a{static from(e){let t=new a;return t.unitMap=new Map(Array.from(e.unitMap)),t.scaleDefinitionList=Array.from(e.scaleDefinitionList),t.recordList=e.recordList.map(e=>e),t.unifiedScaleMap=new Map(Array.from(e.unifiedScaleMap)),t.unifiedTarget=e.unifiedTarget,t.color=e.color||"4b0082",t.calculateResult=e.calculateResult?Array.from(e.calculateResult):[],e.uuid?t.uuid=e.uuid:t.uuid=(0,s.D)(),t.name=e.name?e.name:"ScaleCalculatorPro工程",t}static deserializeFromObject(e){return e.unitMap=n(e.unitMap),e.unifiedScaleMap=n(e.unifiedScaleMap),a.from(e)}getSerializableObject(){let e=a.from(this);return e.unitMap=r(this.unitMap),e.unifiedScaleMap=r(this.unifiedScaleMap),e}canCalculateUnifiedScales(){if(!this.scaleDefinitionList||0===this.scaleDefinitionList.length)return!1;let e=[];return console.log("this.scaleDefinitionList",this.scaleDefinitionList),this.scaleDefinitionList.forEach((t,i,s)=>{console.log("scaleDefinition",t);let r=[];if(e.forEach((e,i,s)=>{console.log("tree",e);let n=0;if(t.scales.forEach((t,i,s)=>{e.has(t.unitUuid)&&n++}),n>1)return console.log("CAN'T CALCULATE: SCALE DUPLICATED"),c.ZP.error("计算失败：比例尺重叠，请编辑比例尺后重试"),!1;1===n&&(t.scales.forEach((t,i,s)=>{e.add(t.unitUuid)}),r.push(e))}),r.length>1){let t=new Set;r.forEach(i=>{i.forEach(e=>{t.add(e)}),e=e.filter(e=>e!==i)})}else if(r.length<1){console.log("no match tree, add one");let i=new Set;t.scales.forEach((e,t,s)=>{i.add(e.unitUuid)}),e.push(i),console.log("new Tree: ",i)}}),!(e.length>1)||(console.log("CAN'T CALCULATE: MORE THAN ONE SCALE TREE"),c.ZP.error("计算失败：比例尺不连通，具有多个独立的部分"),!1)}calculate(e,t){if(!this.unifiedScaleMap.has(e))return[];{let i=[],s=this.unifiedScaleMap.get(e);return this.unifiedScaleMap.forEach((r,n)=>{i.push({unitUuid:n,value:r*t/s,isOrigin:e===n})}),i}}createRecord(e,t,i){this.recordList.push({uuid:(0,s.D)(),unitUuid:e,value:t,name:i})}calculateUnifiedScalers(){if(this.unifiedScaleMap=new Map,!this.canCalculateUnifiedScales())return!1;let e=new Set,t=new Set;for(this.scaleDefinitionList[0].scales.forEach((t,i,s)=>{this.unifiedScaleMap.set(t.unitUuid,t.value),e.add(t.unitUuid)}),t.add(0);t.size<this.scaleDefinitionList.length;)this.scaleDefinitionList.forEach((i,s,r)=>{if(console.log("index",s),!t.has(s)){console.log("is not visited",s);let r=null,n=-1;if(i.scales.forEach((t,i,s)=>{e.has(t.unitUuid)&&(r=t.unitUuid,n=t.value)}),r){console.log("have pivot point",s);let c=this.unifiedScaleMap.get(r);i.scales.forEach((t,i,s)=>{this.unifiedScaleMap.set(t.unitUuid,c/n*t.value),e.add(t.unitUuid)}),t.add(s)}}});this.unifiedTarget||(this.unifiedTarget=this.scaleDefinitionList[0].scales[0].unitUuid);let i=this.unifiedScaleMap.get(this.unifiedTarget);return this.unifiedScaleMap.forEach((e,t,s)=>{this.unifiedScaleMap.set(t,e/i)}),!0}normalizeUnifiedScalesTo(e){return this.unifiedTarget=e,this.calculateUnifiedScalers(),!0}containsUnit(e){for(let t of this.unitMap.values())if(e===t)return!0;return!1}addUnit(e){if(this.containsUnit(e))return null;let t=(0,s.D)();return this.unitMap.set(t,e),t}getUnitUuid(e){let t="";return this.unitMap.forEach((i,s,r)=>{i===e&&(t=s)}),t}constructor(){this.unitMap=new Map,this.scaleDefinitionList=[],this.recordList=[],this.unifiedScaleMap=new Map,this.unifiedTarget=null,this.color="4b0082",this.uuid=(0,s.D)(),this.calculateResult=[],this.name="默认创建的第一个工程"}}},7590:function(e,t,i){"use strict";i.d(t,{D:function(){return r}});var s=i(920);function r(){return(0,s.Z)()}},3054:function(){}},function(e){e.O(0,[192,370,21,796,971,23,744],function(){return e(e.s=4315)}),_N_E=e.O()}]);